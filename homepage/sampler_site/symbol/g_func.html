<!doctype html>
<html lang="ko"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Symbol Wiki: g_func</title>
<link rel="stylesheet" href="../assets/style.css"/>
<script>
window.MathJax={
  tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']]},
  options:{skipHtmlTags:['script','noscript','style','textarea','pre','code']}
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head><body><div class="wrap"><article class="paper"><div class="topnav"><a class="btn" href="index.html">기호 위키 인덱스</a><a class="btn" href="../index.html#notation">최상위 문서(기호 탭)</a></div><h1>Symbol: $g$</h1><p class='muted'><strong>diffusion 계수 함수 (Diffusion coefficient function)</strong></p><h2>모티베이션 (Motivation)</h2><p>SDE에서 ‘난수 항’의 크기를 정하는 함수다. 같은 drift라도 $g$가 크면 경로가 더 흔들리고(분산 증가), $g=0$이면 완전히 결정론적 ODE로 바뀐다.</p><ol class='list'><li>ComfyUI에서 <code>_ancestral</code>, <code>_sde</code>가 붙은 sampler나 <code>er_sde</code> 같은 계열은 step마다 ‘추가 노이즈’를 주입한다. 이 추가 노이즈의 크기를 연속시간 SDE로 표현하면 diffusion 계수 $g(t)$가 된다. 즉 “왜 ancestral이 질감이 더 거칠고 변동이 큰가”는 $g$가 0이 아니기 때문이다.</li><li>같은 drift라도 $g$를 키우면 경로가 더 흔들리고 결과 분포가 더 퍼진다(다양성↑, 그레인/랜덤 텍스처↑). 반대로 $g$를 줄이면 경로가 더 결정론적으로 되며(다양성↓), 특히 영상에서는 프레임 간 일관성이 좋아지는 경향이 있다. 실무의 ‘질감 vs 안정성’ 트레이드오프를 한 변수로 잡아 주는 게 $g$다.</li><li>이산화하면 노이즈 항은 대략 $g(t_k)\sqrt{\Delta t_k}\,\xi_k$ 꼴이므로, 같은 $g$라도 step-size가 크면(=적은 step) 한 번에 들어가는 랜덤 흔들림이 커진다. 그래서 <code>steps</code>/스케줄과 SDE 노이즈 파라미터(<code>eta/s_noise/s_churn</code>)가 서로 얽혀 동작한다.</li><li>일부 sampler는 $\sigma$를 잠깐 ‘올려서’ 탐색을 넓히는(churn) 방식으로 stochasticity를 추가한다. 이런 조작도 연속시간 관점에선 $g$를 구간적으로 키우는 것과 비슷한 효과로 해석할 수 있어, “어느 구간에서 랜덤성을 늘릴지” 설계를 수학적으로 말할 수 있다.</li><li>커스텀 sampler를 만들 때 가장 중요한 설계 중 하나가 “언제 새 노이즈를 뽑을지, 얼마나 섞을지”다. 이를 $g$로 분리해 두면 drift 설계와 독립적으로 stochastic 설계를 바꿀 수 있고, ComfyUI 파라미터 이름으로도 자연스럽게 매핑된다(<code>eta</code>, <code>s_noise</code>, <code>noise_scaler</code> 등).</li></ol><h2>엄밀 정의 (Formal Definitions)</h2><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ g:[0,1]\to[0,\infty) $$</div></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ dX_t=b_\theta(X_t,t,c)\,dt+g(t)\,dW_t $$</div></div><h2>정의 해설 (Commentary)</h2><h3>해설(요약) (Summary)</h3><p>첫 문장은 $g$가 시간에 따라 변할 수 있는 ‘스칼라 함수’라는 뜻이다. (일반 SDE에서는 행렬도 가능하지만, 여기서는 단순화를 위해 스칼라로 적는다.)</p><p>둘째 문장에서 $W_t$는 브라운 운동이다. 따라서 $dW_t$는 평균 0, 분산 $\Delta t$를 갖는 무작위 증분으로 생각할 수 있다.</p><p>그래서 이산화하면 한 step에서 노이즈 항이 대략 $g(t_k)\sqrt{\Delta t_k}\,\xi_k$ 꼴로 나타난다($\xi_k\sim\mathcal{N}(0,1)$). 이 항이 질감/다양성(분산)을 좌우한다.</p><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ g:[0,1]\to[0,\infty) $$</div><h3>해설</h3><ol class='list'><li>시간 $t$에 따라 ‘노이즈의 세기’를 정하는 함수다. $g(t)$가 0이면 그 순간에는 노이즈를 주입하지 않는다.</li><li>일반 이론에서는 $g(t)$가 벡터/행렬일 수도 있지만(비등방성 확산), 많은 diffusion sampling 표기에서는 스칼라 계수로 정리해 쓴다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>노이즈 볼륨을 조절하는 손잡이로 보면 된다.</li></ol><h3>수치 예시</h3><ol class='list'><li>예: $g(t)=0$ (항상 결정론).</li><li>예: $g(t)=0.2+0.8t$ (시간이 갈수록 노이즈가 커짐).</li></ol></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ dX_t=b_\theta(X_t,t,c)\,dt+g(t)\,dW_t $$</div><h3>해설</h3><ol class='list'><li>첫 항 $b_\theta\,dt$는 평균 이동, 둘째 항 $g\,dW_t$는 무작위 이동이다.</li><li>이산화하면 $X_{k+1}\approx X_k+b_\theta(X_k,t_k,c)\Delta t_k+g(t_k)\sqrt{\Delta t_k}\,\xi_k$ 꼴이 된다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>같은 drift라도 노이즈를 더 섞으면 경로가 더 흔들리고, 결과 분포가 더 퍼진다.</li></ol><h3>수치 예시</h3><ol class='list'><li>1차원에서 $b(x)=-x$, $g=0.5$, $x_k=1.0$, $\Delta t=0.04$, $\xi_k=-0.73$이면 $x_{k+1}\approx 1.0+(-1.0)\cdot0.04+0.5\cdot0.2\cdot(-0.73)=1.0-0.04-0.073=0.887$.</li></ol></div><h2>직관(요약) (Intuition)</h2><ol class='list'><li>$b_\theta$는 ‘평균 이동’, $g$는 ‘랜덤 흔들림의 세기’다.</li><li>같은 $b_\theta$라도 $g$를 키우면 샘플이 더 다양해지고, 줄이면 더 결정론적으로 보인다.</li><li>ComfyUI에서 ancestral/SDE 계열의 <code>eta</code>, <code>s_noise</code>, <code>s_churn</code>은 구현 디테일은 달라도 결국 “추가 노이즈 항의 크기”를 조절하는 손잡이로 작동한다. 즉 사용자가 체감하는 ‘거칠어짐/다양성’ 변화는 $g$가 커졌다고 보면 된다.</li></ol><h2>구체 원소 예시(모음) (Concrete Examples)</h2><ol class='list'><li>$g(t)=0$이면 확률항이 사라져 ODE만 남는다(완전 결정론).</li><li>예: $g(t)=0.5$, $\Delta t=0.04$이면 $g\sqrt{\Delta t}=0.5\cdot0.2=0.1$. 표준정규 난수 $\xi=-0.73$을 뽑으면 노이즈 항은 $0.1\cdot(-0.73)=-0.073$ 정도 크기로 더해진다.</li><li>(벡터 노이즈 예) $d=2$에서 $\xi=(0.5,-0.2)$, 스케일이 0.4이면 주입 노이즈는 $0.4\,\xi=(0.2,-0.08)$이다. 코드에선 <code>x = x + 0.4*randn_like(x)</code> 같은 한 줄로 구현된다.</li></ol><h2>코드 대응 (Code Mapping)</h2><ol class='list'><li><code>eta</code>, <code>s_noise</code>, <code>noise_scaler</code> 등이 이 계수의 이산 근사에 해당한다.</li></ol><h2>자주 헷갈리는 점 (Pitfalls)</h2><ol class='list'><li>drift를 잘 맞춰도 $g$가 크면 샘플 분산이 커져 품질이 흔들릴 수 있다.</li></ol><h2>관련 기호 (Related Symbols)</h2><div class='topnav'><a class="btn" href="b_theta.html">$b_\theta$</a><a class="btn" href="Rho_t.html">$\rho_t$</a></div><div class="topnav"><a class="btn" href="b_theta.html">이전: $b_\theta$</a><a class="btn" href="Phi_k.html">다음: $\Phi_k$</a></div></article></div></body></html>