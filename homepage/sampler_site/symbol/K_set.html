<!doctype html>
<html lang="ko"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Symbol Wiki: K_set</title>
<link rel="stylesheet" href="../assets/style.css"/>
<script>
window.MathJax={
  tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']]},
  options:{skipHtmlTags:['script','noscript','style','textarea','pre','code']}
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head><body><div class="wrap"><article class="paper"><div class="topnav"><a class="btn" href="index.html">기호 위키 인덱스</a><a class="btn" href="../index.html#notation">최상위 문서(기호 탭)</a></div><h1>Symbol: $\mathcal{K}$</h1><p class='muted'><strong>허용집합 (Admissible set)</strong></p><h2>모티베이션 (Motivation)</h2><p>샘플러가 만든 상태 $x$가 반드시 만족해야 하는 제약을 모아 둔 ‘허용 집합’이다. 예를 들어 값의 범위를 제한하거나(clip), 마스크 영역을 고정하는(inpaint) 제약을 $\mathcal{K}\subset\mathcal{X}$로 표현한다.</p><ol class='list'><li>ComfyUI의 inpaint/outpaint는 단순히 ‘노이즈를 다시 뿌리는’ 작업이 아니라, 마스크로 지정한 영역은 유지하고 나머지만 샘플링하는 제약 문제로 볼 수 있다. 이때 “유지해야 하는 영역을 만족하는 모든 latent의 집합”이 바로 $\mathcal{K}\subset\mathcal{X}$이고, step마다 마스크를 다시 덮어쓰는 동작은 $\Pi_{\mathcal{K}}$의 한 형태로 해석된다.</li><li>샘플러 업데이트는 때때로 값 폭주/클리핑이 필요한 상황을 만든다(특히 높은 <code>cfg</code>, 공격적인 스케줄, SDE/ancestral에서 큰 잡음 주입). $\mathcal{K}$를 두면 “합법 범위 밖으로 나가면 다시 안으로 넣는다”를 수학적으로 한 줄로 쓰고, 안정성 논의를 ‘집합을 벗어나는가’ 문제로 바꿀 수 있다.</li><li>img2img에서 원본을 얼마나 보존할지(<code>denoise</code> 강도)를 직관적으로 말하면 “초기 상태 근처에 머물게 한다”이다. 이는 $\|x-x_{\mathrm{init}}\|\le R$ 같은 허용집합(공)이나, 그에 대한 페널티/투영으로 모델링할 수 있다. 즉 $\mathcal{K}$ 관점은 생성과 편집을 같은 언어로 묶어 준다.</li><li>현실의 편집은 한 가지 제약만 있지 않다: 마스크 고정 + 값 범위 제한 + (원한다면) 특정 통계/색감 유지 같은 복합 제약이 겹친다. 이런 경우 $\mathcal{K}=\mathcal{K}_1\cap\mathcal{K}_2\cap\cdots$로 두면 ‘어떤 제약을 어떤 순서로 적용할지’가 명시되고, 구현상의 순서(마스크 적용 후 클립 등)와 수식이 대응된다.</li><li>영상 편집에서는 프레임마다 같은 제약을 적용하거나(배경 고정), 프레임 간 제약을 추가로 거는(시간적 부드러움) 경우가 있다. 이를 전부 “허용되는 상태들의 집합”으로 보면, 문제는 결국 $\mathcal{K}$를 어떻게 설계하느냐로 내려간다.</li><li>수치해석/최적화 관점에서 ‘업데이트 후 투영’은 projected method 또는 proximal step으로 해석된다. 그래서 $\mathcal{K}$를 명시하면 단순 클립을 넘어서, 더 정교한 제약(soft/hard, convex/nonconvex)에 대한 구현 아이디어가 자연스럽게 나온다.</li></ol><h2>엄밀 정의 (Formal Definitions)</h2><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ \mathcal{K}\subset\mathcal{X}\ \text{(closed, optionally convex)} $$</div></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ \Pi_{\mathcal{K}}(x)=\arg\min_{y\in\mathcal{K}}\|x-y\|_2 $$</div></div><h2>정의 해설 (Commentary)</h2><h3>해설(요약) (Summary)</h3><p>첫 문장에서 ‘닫힘(closed)’을 강조하는 이유는, $\Pi_{\mathcal{K}}(x)$ 같은 최소화 문제가 해를 가지려면(적어도 존재) 집합이 닫혀 있는 게 안전한 가정이기 때문이다.</p><p>둘째 문장에서 ‘볼록(convex)’을 추가하면, 투영이 거의 항상 유일해지고(최소점이 하나), 구현도 “한 번의 규칙”으로 고정하기 쉬워진다. 반대로 비볼록이면 “가장 가까운 점”이 여러 개가 될 수 있다.</p><p>mask/inpaint 제약은 $\mathcal{K}$를 ‘일부 좌표가 고정된 아핀 부분공간’으로 보는 관점이 가장 직관적이다. 그러면 투영은 고정 좌표를 덮어쓰는 연산으로 떨어진다.</p><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ \mathcal{K}\subset\mathcal{X}\ \text{(closed, optionally convex)} $$</div><h3>해설</h3><ol class='list'><li>$\mathcal{K}$는 ‘허용되는 상태들의 모음’이다. 즉 $x\in\mathcal{K}$이면 제약을 만족한다.</li><li>닫힘 가정은 “최소거리 점이 존재한다”는 성질을 얻기 위한 흔한 안전장치다.</li><li>볼록성 가정은 “최소거리 점이 유일하다”는 성질을 얻기 위한 흔한 안전장치다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>상태가 이 영역을 벗어나면, 다시 안으로 집어넣는 보정 단계가 필요하다.</li></ol><h3>수치 예시</h3><ol class='list'><li>$\mathcal{X}=\mathbb{R}$에서 $\mathcal{K}=[-1,1]$은 닫히고 볼록이다.</li><li>$\mathcal{X}=\mathbb{R}^2$에서 $\mathcal{K}=\{(x_1,x_2):x_1^2+x_2^2\le 1\}$ (원판)도 닫히고 볼록이다.</li></ol></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ \Pi_{\mathcal{K}}(x)=\arg\min_{y\in\mathcal{K}}\|x-y\|_2 $$</div><h3>해설</h3><ol class='list'><li>투영은 ‘가장 가까운 합법 점’을 고르는 연산이다. 거리의 기준은 (여기서는) 유클리드 노름 $\|\cdot\|_2$다.</li><li>볼록이면 목적함수 $y\mapsto\|x-y\|_2^2$가 강볼록이 되어 최소점이 하나로 정해지는 경우가 많다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>clip은 투영의 가장 쉬운 예다: 상자(box) 제약이면 좌표별로 자르면 끝이다.</li><li>마스크 고정은 ‘해당 좌표만 덮어쓰기’로 투영이 구현된다.</li></ol><h3>수치 예시</h3><ol class='list'><li>$\mathcal{K}=[-1,1]$에서 $x=2.3$이면 $\Pi_{\mathcal{K}}(x)=1.0$.</li><li>$\mathcal{K}=\{(0.2,y_2,y_3)\}$에서 $x=(0.9,-1.0,0.1)$이면 $\Pi_{\mathcal{K}}(x)=(0.2,-1.0,0.1)$.</li></ol></div><h2>직관(요약) (Intuition)</h2><ol class='list'><li>규칙을 어긴 상태 $x$를 ‘가장 가까운 합법 상태’로 되돌리는 영역이라고 보면 된다.</li><li>좌표 일부를 고정하는 제약은 “그 좌표만 원래 값으로 되돌린다”는 직관으로 이해하면 된다.</li><li>ComfyUI inpaint에서 “마스크 영역은 원본을 유지”는 전형적으로 $\mathcal{K}$를 ‘일부 좌표가 고정된 아핀 부분공간’으로 두는 것과 같다. 그때 투영 $\Pi_\mathcal{K}$는 고정 좌표를 덮어쓰는 한 줄 연산으로 구현된다.</li><li>코드 구현 관점에서 $\mathcal{K}$가 박스(예: $[-a,a]^d$)이면 $\Pi_\mathcal{K}$는 좌표별 <code>clamp</code>(clip)과 동일하다. 즉 “클리핑은 투영”이라는 말이 정확히 수학 정의(최단거리)로 정리된다.</li><li>제약이 비볼록(non-convex)이면 ‘가장 가까운 점’이 여러 개일 수 있어 투영이 비유일해진다. 실무에서는 보통 한 가지 규칙을 택해 구현하지만, 그 선택이 결과를 바꿀 수 있다는 점이 커스터마이징에서 중요하다.</li></ol><h2>구체 원소 예시(모음) (Concrete Examples)</h2><ol class='list'><li>$\mathcal{X}=\mathbb{R}^2$, $\mathcal{K}=[-1,1]^2$라 하자. $x=(1.4,-0.5)$이면 $\Pi_{\mathcal{K}}(x)=(1.0,-0.5)$이다(첫 좌표만 clip).</li><li>$\mathcal{X}=\mathbb{R}^3$, $\mathcal{K}=\{(0.2,y_2,y_3):y_2,y_3\in\mathbb{R}\}$ (첫 좌표 고정)라 하자. $x=(0.9,-1.0,0.1)$이면 투영은 $(0.2,-1.0,0.1)$이다.</li><li>(마스크 투영 예) $\mathcal{X}=\mathbb{R}^4$, 고정값 $x_{\mathrm{fix}}=(1,1,0,0)$, 마스크 $m=(1,1,0,0)$라 하자(1인 좌표는 고정). 현재 $x=(0.1,0.2,0.3,0.4)$이면 투영(덮어쓰기)은 $\Pi_\mathcal{K}(x)=m\odot x_{\mathrm{fix}}+(1-m)\odot x=(1,1,0.3,0.4)$.</li><li>(볼(ball) 제약 예) $\mathcal{K}=\{x:\|x-x_{\mathrm{init}}\|_2\le 0.5\}$, $x_{\mathrm{init}}=(0,0)$라 하자. $x=(1,0)$는 제약을 깨므로 투영은 $(0.5,0)$가 된다(원점에서 반지름 0.5 원판의 경계로).</li></ol><h2>코드 대응 (Code Mapping)</h2><ol class='list'><li><code>clamp</code>, <code>mask-merge</code>, <code>inpaint overwrite</code> 단계가 사실상 $\Pi_{\mathcal{K}}$에 해당한다.</li></ol><h2>자주 헷갈리는 점 (Pitfalls)</h2><ol class='list'><li>비볼록 제약에서는 ‘가장 가까운 점’이 여러 개일 수 있어 $\Pi_{\mathcal{K}}$가 다가값이 된다(구현 규약이 필요).</li></ol><h2>관련 기호 (Related Symbols)</h2><div class='topnav'><a class="btn" href="Pi_K.html">$\Pi_{\mathcal{K}}$</a><a class="btn" href="X.html">$\mathcal{X}$</a></div><div class="topnav"><a class="btn" href="Hk_Ak.html">이전: $(\mathcal{H}_k,\mathcal{A}_k)$</a><a class="btn" href="M_manifold.html">다음: $\mathcal{M}$</a></div></article></div></body></html>