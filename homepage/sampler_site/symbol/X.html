<!doctype html>
<html lang="ko"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Symbol Wiki: X</title>
<link rel="stylesheet" href="../assets/style.css"/>
<script>
window.MathJax={
  tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']]},
  options:{skipHtmlTags:['script','noscript','style','textarea','pre','code']}
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head><body><div class="wrap"><article class="paper"><div class="topnav"><a class="btn" href="index.html">기호 위키 인덱스</a><a class="btn" href="../index.html#notation">최상위 문서(기호 탭)</a></div><h1>Symbol: $\mathcal{X}$</h1><p class='muted'><strong>상태공간 (State space)</strong></p><h2>모티베이션 (Motivation)</h2><p>샘플러가 매 step 업데이트하는 ‘상태 벡터(=latent)’가 놓이는 공간이다. 구현에서는 대부분 실수 벡터공간 $\mathbb{R}^d$로 생각하면 충분하다.</p><ol class='list'><li>ComfyUI에서 <code>KSampler</code>(및 변형 노드)는 매 step마다 <code>latent</code> 텐서 <code>x</code>를 업데이트한다. 이때 <code>x</code>를 수학적으로 $x\in\mathcal{X}$라고 선언해 두면, 샘플링은 “공간 $\mathcal{X}$ 위의 점을 반복적으로 이동시키는 알고리즘”으로 한 문장에 정리된다.</li><li>샘플러/스케줄러를 바꾸면 한 step이 만드는 이동의 크기와 방향이 달라진다. 이는 보통 $\|x_{k+1}-x_k\|_2$ 같은 거리로 ‘얼마나 움직였는지’를 측정하며, 수치해석의 안정성/오차(그리고 결과의 뭉개짐·과샤프·색폭주 같은 체감 품질)와 직접 연결된다.</li><li>편집 작업(인페인트/아웃페인트, 마스크 고정, latent 합성, clip/normalize, 후처리 denoise 등)은 결국 $\mathcal{X}\to\mathcal{X}$ 사상들의 합성이다. 어떤 연산이 “같은 공간에서” 합법적으로 합성되는지(예: latent끼리 합치기 vs 픽셀에서 합치기)를 명확히 하려면 먼저 $\mathcal{X}$를 고정해야 한다.</li><li>모델 출력(denoised/score/velocity)은 ‘다음으로 가는 방향’을 나타내는 같은 차원의 벡터다. 즉 $D_\theta(x,\sigma,c)\in\mathcal{X}$, $b_\theta(x,t,c)\in\mathcal{X}$ 같은 타입 선언이 서야 ODE/SDE 해석(벡터장, 흐름, 적분)이 문법적으로 성립한다.</li><li>영상 생성(AnimateDiff 등)처럼 시간축이 붙으면 텐서 차원은 늘지만, 수학적으로는 여전히 거대한 유클리드 공간의 한 점이다(예: $\mathbb{R}^{C\cdot T\cdot H\cdot W}$). 이 관점이 있어야 “프레임 간 일관성” 같은 문제도 결국 같은 상태공간에서의 제약/수송 문제로 통일해 볼 수 있다.</li></ol><h2>엄밀 정의 (Formal Definitions)</h2><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ \mathcal{X}=\mathbb{R}^d $$</div></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ \langle x,y\rangle=x^\top y,\qquad \|x\|_2=\sqrt{x^\top x} $$</div></div><div class='box'><p class='small'><strong>정의 3.</strong></p><div class='formula'>$$ x_k:(\Omega,\mathcal{F}_k)\to(\mathcal{X},\mathcal{B}(\mathcal{X})) $$</div></div><h2>정의 해설 (Commentary)</h2><h3>해설(요약) (Summary)</h3><p>첫 문장은 “$x$가 어떤 ‘공간’의 원소인지”를 명시하는 선언이다. 힐베르트 공간을 가정하면 내적과 노름이 자동으로 따라오고, 이는 수치해석에서 오차(예: $\|x_{k+1}-x_k\|$)를 재는 기준이 된다.</p><p>두 번째 문장은 실무에서 거의 항상 쓰는 특수화다. 모델과 샘플러가 다루는 텐서는 유한차원이므로, 결국 $\mathbb{R}^d$의 한 벡터로 보면 된다. 여기서 $d$는 채널/해상도 등을 곱한 총 자유도다.</p><p>세 번째 문장은 “샘플러가 난수를 쓰는 확률 과정”이라는 점을 엄밀히 적는 방식이다. 보통 구현을 이해하는 데는 꼭 필요하진 않지만, 분포 $\rho_t$, FPE/OT 같은 문서로 넘어가면 결국 이 문장들이 문법을 책임진다.</p><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ \mathcal{X}=\mathbb{R}^d $$</div><h3>해설</h3><ol class='list'><li>유한차원 구현에서는 상태를 길이 $d$인 실수 벡터로 본다. 여기서 $d$는 ‘latent 텐서의 총 성분 수’다.</li><li>텐서 모양이 $(C,H,W)$이면 $d=C\cdot H\cdot W$이고, 배치까지 포함하면 샘플 단위로는 각 배치 원소가 $\mathbb{R}^d$의 한 점이다.</li><li>이렇게 보면 sampler는 $\mathbb{R}^d$ 위에서 $x\mapsto x'$를 반복하는 알고리즘으로 해석된다(수치적분 관점).</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>‘이미지’가 아니라 ‘좌표’라고 생각하자. 좌표가 몇 차원이든, 샘플러는 그 좌표를 움직인다.</li><li>코드의 <code>x</code> 텐서는 결국 한 점 $x\in\mathbb{R}^d$로 읽으면 된다.</li></ol><h3>수치 예시</h3><ol class='list'><li>$d=4$라면 $x=(1.0,\,-0.2,\,0.1,\,0.0)\in\mathbb{R}^4$.</li><li>$C=4,H=2,W=2$면 $d=16$이고, 예를 들어 $x=(0.1,-0.3,0.0,0.8,\,0.2,0.0,\dots)$ 같은 벡터가 된다.</li></ol></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ \langle x,y\rangle=x^\top y,\qquad \|x\|_2=\sqrt{x^\top x} $$</div><h3>해설</h3><ol class='list'><li>내적/노름은 ‘크기’와 ‘거리’를 정의한다. 예를 들어 projection $\Pi_{\mathcal{K}}$는 $\|x-y\|_2$를 최소화하는 $y$를 찾는 연산이다.</li><li>solver의 step-size가 작을수록 $\|x_{k+1}-x_k\|_2$가 작아지는 경향이 있고, 이는 수치 안정성 직관과 연결된다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>실무에서는 “유클리드 거리”로 생각하면 대부분 맞는다.</li></ol><h3>수치 예시</h3><ol class='list'><li>$x=(1,2)$, $y=(3,-1)$이면 $\langle x,y\rangle=1\cdot3+2\cdot(-1)=1$.</li><li>$x=(3,4)$이면 $\|x\|_2=5$.</li></ol></div><div class='box'><p class='small'><strong>정의 3.</strong></p><div class='formula'>$$ x_k:(\Omega,\mathcal{F}_k)\to(\mathcal{X},\mathcal{B}(\mathcal{X})) $$</div><h3>해설</h3><ol class='list'><li>이 문장은 “$x_k$는 난수에 의해 결정되는 값(확률변수)”라는 뜻이다. 입력은 $\omega\in\Omega$ (난수 시나리오)이고 출력은 상태공간의 점 $x_k(\omega)\in\mathcal{X}$다.</li><li>가측성은 ‘사건을 사건으로 보낸다’는 조건인데, 실무에서는 보통 “코드가 난수로부터 $x_k$를 계산한다” 정도로 받아들이면 된다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>seed를 바꾸면 $\omega$가 바뀌고, 그 결과로 $x_k$ 값도 바뀐다. 이 관계를 엄밀히 적은 표현이다.</li></ol><h3>수치 예시</h3><ol class='list'><li>예를 들어 $\Omega=\{1,2\}$, $\mathbb{P}(1)=\mathbb{P}(2)=0.5$라 두고, $x_k(1)=(0.0,0.0)$, $x_k(2)=(1.0,0.0)$처럼 정의하면 $x_k$는 $\mathbb{R}^2$값 확률변수다.</li></ol></div><h2>직관(요약) (Intuition)</h2><ol class='list'><li>샘플러는 ‘점 $x$를 조금씩 옮기는 규칙’이고, $\mathcal{X}$는 그 점이 사는 좌표공간이다.</li><li>이미지 픽셀 공간이 아니라 ‘압축된 좌표(latent)’라 해도, 수학적으로는 그냥 벡터공간의 한 점이다.</li><li>ComfyUI에서는 <code>latent</code> 텐서가 바로 $x\in\mathcal{X}$이고, <code>KSampler</code>의 각 step은 이 $x$를 업데이트한다. 미리보기(preview)는 보통 VAE 디코더 $\\mathrm{Dec}:\\mathcal{X}\\to\\mathbb{R}^{H\\times W\\times 3}$를 적용해 $x$를 이미지로 ‘관측’하는 것이라고 이해하면 된다.</li><li>모델 출력(denoised/score/velocity)도 결국 같은 차원의 벡터이므로 $\mathcal{X}$의 원소로 취급된다.</li></ol><h2>구체 원소 예시(모음) (Concrete Examples)</h2><ol class='list'><li>$\mathcal{X}=\mathbb{R}^3$라고 두면 $x=(0.2,\,-1.1,\,3.4)\in\mathcal{X}$는 ‘구체적인 상태’ 한 개다.</li><li>$\mathcal{X}=\mathbb{R}^4$에서 $x_0=(1.0,0.0,0.0,0.0)$, $x_1=(0.7,-0.2,0.1,0.0)$처럼 step마다 값이 바뀐다.</li><li>텐서가 <code>x.shape=(1,4,2,2)</code>라면 펼쳐서 $d=16$인 벡터로 볼 수 있고, 예를 들어 첫 몇 성분이 $(0.1,-0.3,0.0,0.8,...)$처럼 실수로 채워진다.</li><li>(ComfyUI 예) 512×512 기준으로 latent가 <code>x.shape=(1,4,64,64)</code>라면 $d=4\cdot64\cdot64=16384$이고, 예를 들어 펼친 벡터의 앞부분이 $(0.12,-0.34,0.05,0.80,\dots)$처럼 실수로 채워진 한 점 $x\in\mathbb{R}^{16384}$로 볼 수 있다.</li></ol><h2>코드 대응 (Code Mapping)</h2><ol class='list'><li><code>x</code>, <code>latent</code>, <code>x_t</code> 같은 변수들이 보통 $\mathcal{X}$의 원소다.</li><li>KSampler step 함수의 입력/출력 첫 인자가 이 공간에서 움직인다.</li></ol><h2>자주 헷갈리는 점 (Pitfalls)</h2><ol class='list'><li>공간을 명시하지 않으면 노름/내적/거리(수치오차 분석의 기준)가 모호해진다.</li></ol><h2>관련 기호 (Related Symbols)</h2><div class='topnav'><a class="btn" href="B_X.html">$\mathcal{B}(\mathcal{X})$</a><a class="btn" href="Hk_Ak.html">$(\mathcal{H}_k,\mathcal{A}_k)$</a><a class="btn" href="Phi_k.html">$\Phi_k$</a><a class="btn" href="D_theta.html">$D_\theta$</a></div><div class="topnav"><a class="btn" href="B_X.html">다음: $\mathcal{B}(\mathcal{X})$</a></div></article></div></body></html>