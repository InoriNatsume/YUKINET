<!doctype html>
<html lang="ko"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Symbol Wiki: M_manifold</title>
<link rel="stylesheet" href="../assets/style.css"/>
<script>
window.MathJax={
  tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']]},
  options:{skipHtmlTags:['script','noscript','style','textarea','pre','code']}
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head><body><div class="wrap"><article class="paper"><div class="topnav"><a class="btn" href="index.html">기호 위키 인덱스</a><a class="btn" href="../index.html#notation">최상위 문서(기호 탭)</a></div><h1>Symbol: $\mathcal{M}$</h1><p class='muted'><strong>매장 부분다양체 (Embedded submanifold)</strong></p><h2>모티베이션 (Motivation)</h2><p>상태가 $\mathbb{R}^d$ 전체가 아니라 어떤 ‘곡면/제약집합’ 위에 있어야 하는 상황을 수학적으로 쓰기 위해 $\mathcal{M}\subset\mathcal{X}$를 둔다. 예를 들어 “항상 길이가 1인 벡터” 같은 제약은 다양체(구면)로 표현된다.</p><ol class='list'><li>일부 제약은 단순한 박스/선형 제약(클립, 마스크 고정)처럼 ‘집합’으로만 보기엔 구조가 더 강하다. 예를 들어 항상 $\|x\|_2=1$을 유지하는 조건은 구면 $S^{d-1}$이고, 이는 매끄러운 다양체다. 이런 제약을 자연스럽게 다루려면 $\mathcal{M}\subset\mathcal{X}$라는 다양체 관점이 필요하다.</li><li>ComfyUI 작업에서도 ‘정규화’가 은근히 자주 등장한다(예: 어떤 특징/임베딩을 단위노름으로 정규화해서 쓰거나, 특정 방향 성분을 제거하는 후처리). 이런 조작을 step마다 반복하면, 사실상 상태를 어떤 다양체 근처에 붙잡아 두는 알고리즘이 된다. 이를 수학적으로 제대로 설명하는 언어가 다양체/접공간/리트랙션이다.</li><li>유클리드 공간에서의 단순 업데이트 $x\leftarrow x+\Delta$는 곧바로 제약을 깨뜨릴 수 있다. 다양체에서는 먼저 $\Delta\in T_x\mathcal{M}$ 같은 ‘허용 방향’에서 보정 벡터를 계산하고, 그 다음 $R_x(\Delta)$로 다시 $\mathcal{M}$ 위에 올려 보내는 두 단계 구조가 표준이다. 이 구조가 정리되면 구현도 “보정 계산”과 “제약 복귀”로 분해되어 안정해진다.</li><li>수치해석 관점에서 다양체는 ‘제약을 만족하는 상태들’의 국소 좌표계를 제공한다. 그래서 고차 solver를 쓰거나, 제약을 만족하는 채로 오차를 제어하려면(예: 장기 드리프트 억제) 다양체 언어가 도움이 된다.</li><li>확산/샘플링 자체를 다양체 위에서 정의하는 연구도 많다(회전/포즈, 방향 데이터, 정규화된 표현 등). 생성·편집을 넘어 새로운 모델/샘플러를 커스터마이즈하려면 $\mathcal{M}$을 기본 도구로 갖고 있는 편이 유리하다.</li></ol><h2>엄밀 정의 (Formal Definitions)</h2><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ \mathcal{M}\subset\mathcal{X}\ \text{is an embedded }C^r\text{ submanifold} $$</div></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ v\in T_x\mathcal{M}\ \xrightarrow{\ R_x\ }\ R_x(v)\in\mathcal{M} $$</div></div><h2>정의 해설 (Commentary)</h2><h3>해설(요약) (Summary)</h3><p>첫 문장은 $\mathcal{M}$이 ‘잘 behaved한’ 제약집합이라는 뜻이다. $C^r$ 매장 부분다양체라는 가정은 국소적으로는 $\mathbb{R}^m$처럼 보이고(좌표계가 존재), 미분기하적 도구(접공간, 미분, 곡선 등)를 쓸 수 있게 해 준다.</p><p>둘째 문장은 계산을 어디에서 하느냐를 분리한다: (1) 접공간 $T_x\mathcal{M}$에서 선형 연산으로 보정 벡터를 계산하고, (2) 그 결과를 retraction으로 다시 다양체 위 점으로 올려 보낸다.</p><p>실무에서는 ‘진짜’ 지오데식(exp map)을 쓰기보다, 계산이 싼 retraction(예: 정규화)을 쓰는 경우가 많다. 이때도 $R_x(0)=x$와 $dR_x(0)=\mathrm{Id}$ 같은 성질 덕분에 1차 정확도는 유지된다.</p><div class='box'><p class='small'><strong>정의 1.</strong></p><div class='formula'>$$ \mathcal{M}\subset\mathcal{X}\ \text{is an embedded }C^r\text{ submanifold} $$</div><h3>해설</h3><ol class='list'><li>‘부분다양체’라는 말은, $\mathcal{M}$이 어떤 제약식들로 잘 정의된(매끄러운) 집합이라는 뜻이다. 그래서 점 근처에서 접평면/좌표계를 쓸 수 있다.</li><li>예를 들어 $S^1=\{x\in\mathbb{R}^2:\|x\|_2=1\}$은 1차원 다양체(원)이고, $S^{d-1}\subset\mathbb{R}^d$는 구면이다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>제약을 ‘곡면’이라고 생각하면 된다. 곡면 위에서만 움직이게 하려면 곡면의 기하를 써야 한다.</li></ol><h3>수치 예시</h3><ol class='list'><li>$\mathbb{R}^2$에서 $\mathcal{M}=\{(x_1,x_2):x_1+x_2=1\}$는 직선(1차원 다양체)이고, 예를 들어 $(0.3,0.7)$이 그 위의 점이다.</li><li>$\mathbb{R}^2$에서 $\mathcal{M}=S^1$이면 $(0.6,0.8)$은 그 위의 점이고, $(0.6,0.7)$은 아니다(노름이 1이 아님).</li></ol></div><div class='box'><p class='small'><strong>정의 2.</strong></p><div class='formula'>$$ v\in T_x\mathcal{M}\ \xrightarrow{\ R_x\ }\ R_x(v)\in\mathcal{M} $$</div><h3>해설</h3><ol class='list'><li>접공간에서 계산한 보정 벡터 $v$를 실제 제약집합 위의 점으로 바꾸려면 어떤 ‘올림(map)’이 필요하다. 그 역할이 retraction $R_x$다.</li><li>retraction은 $v$가 작을 때 $x+v$와 비슷한 효과를 내되, 결과가 $\mathcal{M}$ 위에 있도록 만들어 준다.</li></ol><h3>직관(정의와 연결)</h3><ol class='list'><li>“접평면에서 한 걸음 → 곡면 위로 붙이기”라는 두 단계로 생각하면 직관적이다.</li></ol><h3>수치 예시</h3><ol class='list'><li>$\mathcal{M}=S^1$, $x=(0.6,0.8)$, $v=(0.1,-0.2)$면 $x+v=(0.7,0.6)$이고 정규화 retraction은 $R_x(v)=\frac{(0.7,0.6)}{\|(0.7,0.6)\|}\approx(0.759,0.651)$.</li></ol></div><h2>직관(요약) (Intuition)</h2><ol class='list'><li>전체 공간(평면/공간) 안에 있는 ‘곡면 위로만 이동’한다고 생각하면 된다.</li><li>업데이트를 하더라도 매번 $\mathcal{M}$ 위로 다시 올려 보내는 보정이 필요할 수 있다.</li><li>정의역이 유클리드 공간이라도 “실제로 의미 있는 상태”가 어떤 제약식을 만족한다면, 그 제약해 집합을 $\mathcal{M}$으로 본다(예: $f(x)=0$의 해집합). 다양체(manifold)라는 가정은 그 제약이 국소적으로 매끄럽게 풀린다는 뜻이다.</li><li>ComfyUI/코드에서는 <code>normalize</code>, <code>orthogonalize</code>, “특정 성분 제거” 같은 후처리가 자주 등장하는데, 이런 연산은 상태를 어떤 곡면/부분공간 근처로 되돌리는 ‘기하학적 보정’으로 해석할 수 있다. 즉 “매 step 보정”을 수학적으로는 $x\mapsto R_x(v)$ 또는 $x\mapsto \Pi_{\mathcal{M}}(x)$로 적는다.</li></ol><h2>구체 원소 예시(모음) (Concrete Examples)</h2><ol class='list'><li>$\mathcal{X}=\mathbb{R}^2$, $\mathcal{M}=S^1=\{x:\|x\|_2=1\}$라 하자. $(0.6,0.8)$은 $\|x\|_2=1$이므로 $\mathcal{M}$ 위의 점이다.</li><li>$\mathcal{X}=\mathbb{R}^2$, $\mathcal{M}=\{(x_1,x_2):x_1+x_2=1\}$ (직선)이라 하자. $(0.3,0.7)\in\mathcal{M}$이다.</li><li>(3차원 구면 예) $\mathcal{X}=\mathbb{R}^3$, $\mathcal{M}=S^2=\{x:\|x\|_2=1\}$라 하자. $x=(1,0,0)$과 $y=(0,0.6,0.8)$는 $\mathcal{M}$ 위의 점이다.</li><li>(곡선 제약 예) $\mathcal{X}=\mathbb{R}^2$, $\mathcal{M}=\{(u,u^2):u\in\mathbb{R}\}$ (포물선)이라 하자. $u=2$이면 점 $(2,4)\in\mathcal{M}$이고, $(2,3)$은 $\mathcal{M}$ 위가 아니다.</li></ol><h2>코드 대응 (Code Mapping)</h2><ol class='list'><li><code>normalize(x)</code> 같은 후처리가 다양체로의 복귀 역할을 할 수 있다.</li></ol><h2>자주 헷갈리는 점 (Pitfalls)</h2><ol class='list'><li>유클리드 보정벡터를 그대로 더하면 다양체를 이탈하므로 retraction/projection이 필요하다.</li></ol><h2>관련 기호 (Related Symbols)</h2><div class='topnav'><a class="btn" href="TxM.html">$T_x\mathcal{M}$</a><a class="btn" href="R_x.html">$R_x$</a><a class="btn" href="X.html">$\mathcal{X}$</a></div><div class="topnav"><a class="btn" href="K_set.html">이전: $\mathcal{K}$</a><a class="btn" href="TxM.html">다음: $T_x\mathcal{M}$</a></div></article></div></body></html>